const e=document.getElementById("answer"),t=document.querySelector(".multiple"),o=document.querySelector('label[for="answerB"]');let n=0;if(window.location.pathname.includes("/add-poll")){o.insertAdjacentHTML("afterend",' <button class="add-answer">Add Answer</button>');const i=document.querySelector(".add-answer");i.addEventListener("click",e=>{let t;if(console.log(e),e.preventDefault(),n++,!(n<4))return;if(1===n)t="C";else if(2===n)t="D";else{if(3!==n)return void(i.disabled=!0);t="E"}const o=document.createElement("Label");o.setAttribute("for","answer"+t),o.innerHTML=t;const a=document.createElement("Input");a.setAttribute("type","text"),a.setAttribute("name","answer"+t),o.appendChild(a),i.parentNode.insertBefore(o,i)}),e&&e.addEventListener("change",()=>{const o=e.value;t.style.display="multiple"===o?"flex":"none"})}const i={apiKey:"AIzaSyCYh5eAY97Umv7z1SsqOaD4Kax8JVkHz9c",authDomain:"poller-3def1.firebaseapp.com",databaseURL:"https://poller-3def1-default-rtdb.europe-west1.firebasedatabase.app",projectId:"poller-3def1",storageBucket:"poller-3def1.appspot.com",messagingSenderId:"361512679720",appId:"1:361512679720:web:0cab0e67a7454442d6f81d",measurementId:"G-7NHRRMFQS1"};firebase.initializeApp(i);const a=firebase.messaging(),r=document.querySelector(".notisElem");if("Notification"in window)if("granted"===Notification.permission){console.log("Permission granted");new Notification("Hi! You will be notified when a poll is activated")}else"denied"!==Notification.permission&&Notification.requestPermission().then(e=>{if("granted"===e){new Notification("Hi! You will be notified when a poll is activated")}});else alert("This browser does not support desktop notification");a.getToken({vapidKey:"BGBWBKYjaQdJic_twf3FnVUh9UBOKe8QnaIRgij2OM74CCt9fyFm_Psi9IikIn-ELjN4svtWwQCGsph93fq2cZc"}).then(e=>{e?console.log("currentToken",e):console.log("No registration token available. Request permission to generate one.")}).catch(e=>{console.log("An error occurred while retrieving token. ",e)});let l=!0;a.onMessage(e=>{if(console.log("Message received. ",e),r.innerHTML=e.notification.body,l){const{title:t,...o}=JSON.parse(e.data.notification);navigator.serviceWorker.getRegistrations().then(e=>{e[0].showNotification(t,o).then(e=>console.log("notifcationShow",e)).catch(e=>console.log(e))})}});const s=document.querySelectorAll(".poll"),d=document.querySelector(".poll-title"),c=document.querySelector(".poll-drop-zone"),p=document.querySelectorAll(".tool-position-drag"),g=document.querySelectorAll(".tool-position-up"),u=document.querySelectorAll(".tool-position-down");let f="",m=0;const h=firebase.database(),v=h.ref(`poll-list/${d.innerHTML}/polls`);if("draggable"in document.createElement("span")){function b(e){e.dataTransfer.setData("text/plain",e.currentTarget.id),e.currentTarget.classList.add("dragging")}function w(e){e.preventDefault(),f=e.currentTarget.cloneNode(!0);let t=e.dataTransfer.getData("text"),o=document.querySelectorAll(".poll-drop-zone > *");for(let e=0;e<o.length;e++)if(o[e].id===t){m=e;break}let n=document.getElementById(t);const i=parseInt(e.currentTarget.id)+1;let a=parseInt(t)+1;t!==e.currentTarget.id&&(console.log(n,e.currentTarget),n.id=f.id,c.replaceChild(n,e.currentTarget),f.id=t,c.insertBefore(f,c.children[m]),f.addEventListener("drop",w),f.addEventListener("dragstart",b),n.addEventListener("drop",w),n.addEventListener("dragstart",b),v.once("value").then(e=>{e.forEach(e=>{console.log("shot.val()",e.val().position,i,a),e.val().position===i?v.child(""+e.key).child("position").set(a).then(e=>console.log("Updated old position",e)).catch(e=>console.log("error updating",e)):e.val().position===a&&v.child(""+e.key).child("position").set(i).then(e=>console.log("Updated old position",e)).catch(e=>console.log("error updating",e))})}).catch(e=>console.log(e)),n.classList.add("drag-animation"),setTimeout(()=>{n.classList.remove("dragging"),n.classList.remove("drag-animation")},1e3))}console.log("Drag support detected"),p.forEach(e=>{e.classList.toggle("hidden")}),g.forEach(e=>{e.classList.toggle("hidden")}),u.forEach(e=>{e.classList.toggle("hidden")}),s.forEach(e=>{e.addEventListener("dragstart",b),e.addEventListener("dragover",e=>{e.preventDefault()}),e.addEventListener("drop",w)}),c.addEventListener("dragover",e=>{e.preventDefault()})}